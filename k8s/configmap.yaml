apiVersion: v1
kind: ConfigMap
metadata:
  name: angel-intelligence-config
  namespace: default
  labels:
    app: angel-intelligence
data:
  # Environment
  angel-env: "production"
  
  # Processing Configuration
  poll-interval: "30"
  max-concurrent-jobs: "1"
  max-retry-attempts: "3"
  retry-delay-hours: "1"
  
  # Analysis mode: 'audio' or 'transcript'
  analysis-mode: "transcript"
  
  # Transcription settings
  transcript-segmentation: "word"
  
  # PII redaction
  enable-pii-redaction: "true"
  
  # Chat model preloading
  preload-chat-model: "true"
  
  # Max transcript length (0=unlimited, 8000 for smaller models)
  max-transcript-length: "0"
  
  # Whisper Model
  whisper-model: "medium"
  whisper-model-path: "/models/whisper"
  
  # Analysis Model (for batch call processing)
  analysis-model: "Qwen/Qwen2.5-32B-Instruct-AWQ"
  analysis-model-path: "/models/analysis"
  analysis-model-quantization: "none"  # AWQ is pre-quantized
  
  # Chat Model (for interactive requests)
  chat-model: "Qwen/Qwen2.5-7B-Instruct"
  chat-model-path: "/models/chat"
  chat-model-quantization: "int4"
  
  # vLLM Configuration (shared model server)
  use-vllm: "true"
  vllm-base-url: "http://vllm-server:8000/v1"
  
  # LoRA Adapter Configuration (for fine-tuned analysis)
  analysis-adapter-name: "call-analysis"
  models-base-path: "/models"
  
  # Worker mode: 'batch', 'interactive', 'both', or 'api'
  worker-mode: "both"
  
  # PBX Recording Sources
  pbx-live-url: "https://pbx.angelfs.co.uk/callrec/"
  pbx-archive-url: "https://afs-pbx-callarchive.angelfs.co.uk/"
  
  # GPU Configuration (0 for first GPU, -1 for CPU only)
  # On multi-GPU systems, set to the index of the NVIDIA GPU
  cuda-visible-devices: "0"
  
  # Model hot reload (production feature)
  enable-model-hot-reload: "false"

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: angel-intelligence-models
  namespace: default
  labels:
    app: angel-intelligence
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: nfs-client  # Use your NFS provisioner
  resources:
    requests:
      storage: 50Gi
